!function e(t,n,o){function i(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n||e)},l,l.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";var o=(e("./audio/Audio"),e("./routes")),i=e("./components/main/mainController"),r=e("./components/test/testController");!function(){var e=angular.module("myApp",["ngRoute"]);e.config(["$routeProvider",o.initRoutes]),e.controller("mainController",["$scope",i.mainController]),e.controller("testController",["$scope",r.testController])}()},{"./audio/Audio":2,"./components/main/mainController":6,"./components/test/testController":7,"./routes":8}],2:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Audio=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./audio-loader"),a=e("../utils/utils"),u=e("./Track");n.Audio=function(){function e(){o(this,e),this.tag="[Audio.js]";var t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.bpm=120,this.tickTime=60/this.bpm/4,this.isPlaying=!1,this.buffers={},this.tracks=[],this.defaultBuffersLoaded=!1,this.defaultTracksLoaded=!1,this.currentTickIndex=1,this.soundURLs={kick:"app/assets/audio/kick.wav",snare:"app/assets/audio/snare.wav",hat:"app/assets/audio/hat.wav",ride:"app/assets/audio/ride.wav"},(0,a.checkIfiOSdevice)()?this._enableAudioContextForiOS():this.audioContextEnabled=!0,this._loadDefaultBuffers()}return i(e,[{key:"_enableAudioContextForiOS",value:function(){var e=this;$(document).ready(function(){var t=$("<button/>",{visibility:"hidden"});t.on("touchstart",function(){var t=e.audioContext.createBuffer(1,1,22050),n=e.audioContext.createBufferSource();n.buffer=t,n.start()}),t.trigger("touchstart"),e.audioContextEnabled=!0,console.log("AudioContext enabled for iOS")})}},{key:"_loadDefaultBuffers",value:function(){var e=this,t=this.audioContext,n=this.soundURLs;Promise.all([(0,r.audioLoader)(t,n.kick),(0,r.audioLoader)(t,n.snare),(0,r.audioLoader)(t,n.hat),(0,r.audioLoader)(t,n.ride)]).then(function(t){e.buffers.kick=t[0],e.buffers.snare=t[1],e.buffers.hat=t[2],e.buffers.ride=t[3],e.defaultBuffersLoaded=!0,console.log(e.buffers),e.defaultBuffersLoaded=!0,console.log("Default buffers loaded"),e._initDefaultTracks()})}},{key:"_initDefaultTracks",value:function(){if(this.defaultBuffersLoaded){this.tracks=[];var e=new u.Track(this.audioContext,"kick",this.buffers.kick);e.setTicksFromArray([1,5,9,13]);var t=new u.Track(this.audioContext,"snare",this.buffers.snare,1,.1);t.setTicksFromArray([5,13]);var n=new u.Track(this.audioContext,"hat",this.buffers.hat,.85,-1);n.setTicksFromArray([{index:1,volume:.9},{index:2,volume:.5},{index:3,volume:1.2},{index:4,volume:.4},{index:5,volume:.9},{index:6,volume:.5},{index:7,volume:1.2},{index:8,volume:.4},{index:9,volume:.9},{index:10,volume:.5},{index:11,volume:1.2},{index:12,volume:.4},{index:13,volume:.9},{index:14,volume:.5},{index:15,volume:1.2},{index:16,volume:.4}]),this.tracks.push(e),this.tracks.push(t),this.tracks.push(n),this.defaultTracksLoaded=!0,console.log("Default tracks loaded"),console.log(this.tracks)}}},{key:"_onBpmChanged",value:function(){this.tickTime=60/this.bpm/4}},{key:"_start",value:function(){function e(){i<=n.currentTime+t.tickTime&&(t.tracks.forEach(function(e){if(!e.mute&&e.buffer){var t=e.ticks[r];if(t.active){var o=n.createBufferSource();o.buffer=e.buffer;var a=n.createGain();o.connect(a),a.gain.value=t.volume,a.connect(e.gainNode),o.start(i)}}}),t.currentTickIndex=r,console.log("Tick "+t.currentTickIndex),i+=t.tickTime,r+=1,r=r>16?1:r),window.setTimeout(e,0)}if(!this.audioContextEnabled)return void console.log("Cannot play: AudioContext is not enabled.");if(this.isPlaying)return void console.log("Cannot play: it is already playing.");if(!this.defaultTracksLoaded)return void console.log("Cannot play: default tracks not loaded.");this.isPlaying=!0;var t=this,n=this.audioContext,o=n.currentTime,i=o+t.tickTime,r=1;e()}},{key:"_playSound",value:function(e,t){var n=this.audioContext,o=n.createBufferSource();o.buffer=this.buffers[e],o.connect(n.destination),o.start(t)}},{key:"addNewTrack",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.buffers.hasOwnProperty(e))return void console.log("Track name collision");(0,r.audioLoader)(this.audioContext,t).then(function(t){n.buffers[e]=t;var r=new u.Track(n.audioContext,e,n.buffers[e],o,i);n.tracks.push(r),console.log("Added track ",r)},function(e){console.log("ERROR",e)})}},{key:"bpm",get:function(){return this._bpm},set:function(e){e!==this._bpm&&(this._bpm=e,this._onBpmChanged())}}]),e}()},{"../utils/utils":9,"./Track":4,"./audio-loader":5}],3:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.Tick=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;o(this,e),this.active=t,this.volume=n}return i(e,[{key:"volume",get:function(){return this._volume},set:function(e){this._volume=e>1?1:e}}]),e}()},{}],4:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Track=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("./Tick");n.Track=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"track_default",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];o(this,e),this.name=n,this.buffer=i,this.mute=u,this.ticks=[],this.gainNode=t.createGain(),this.gainNode.gain.value=r,"function"==typeof t.createStereoPanner?(this.pannerNode=t.createStereoPanner(),this.pannerNode.pan.value=a,this.gainNode.connect(this.pannerNode),this.pannerNode.connect(t.destination),console.log("Stereo panner supported")):(this.gainNode.connect(t.destination),console.log("Stereo panner not supported")),this._initTicks()}return r(e,[{key:"_initTicks",value:function(){this.ticks=[];for(var e=0;e<=16;++e)this.ticks.push(new a.Tick)}},{key:"setTick",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e<1||e>16||(this.ticks[e].volume=n,this.ticks[e].active=t)}},{key:"setTicksFromArray",value:function(e){var t=this;e.forEach(function(e){if("object"===(void 0===e?"undefined":i(e))){if(!e.index||e.index<1||e.index>16)return;var n=t.ticks[e.index];n.volume=e.volume?e.volume:1,n.active=!e.active||e.active}else t.ticks[e].active=!0})}}]),e}()},{"./Tick":3}],5:[function(e,t,n){"use strict";function o(e,t){return new Promise(function(n,o){if(!e)return void o("Missing audio context parameter.");if(!t)return void o("Missing url parameter");var i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.onload=function(){try{e.decodeAudioData(i.response,function(e){n(e)})}catch(e){o(e)}},i.send()})}Object.defineProperty(n,"__esModule",{value:!0}),n.audioLoader=o},{}],6:[function(e,t,n){"use strict";function o(e){e.title="Main Controller",console.log("Main controller")}Object.defineProperty(n,"__esModule",{value:!0}),n.mainController=o},{}],7:[function(e,t,n){"use strict";function o(e){e.title="Test Controller",console.log("Test Controller")}Object.defineProperty(n,"__esModule",{value:!0}),n.testController=o},{}],8:[function(e,t,n){"use strict";function o(e){e.when("/",{controller:"mainController",templateUrl:"app/components/main/mainView.html"}),e.when("/test",{controller:"testController",templateUrl:"app/components/test/testView.html"}),e.otherwise({redirectTo:"/"})}Object.defineProperty(n,"__esModule",{value:!0}),n.initRoutes=o},{}],9:[function(e,t,n){"use strict";function o(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}Object.defineProperty(n,"__esModule",{value:!0}),n.checkIfiOSdevice=o},{}]},{},[1]);
//# sourceMappingURL=app.bundle.min.js.map
