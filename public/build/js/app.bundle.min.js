!function e(t,n,a){function o(r,s){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return o(n||e)},l,l.exports,e,t,n,a)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<a.length;r++)o(a[r]);return o}({1:[function(e,t,n){"use strict";var a=e("./routes"),o=e("./components/drum-machine/drumMachineController"),i=e("./components/test/testController"),r=e("./directives/trackDirective"),s=e("./directives/tickSliderDirective"),c=e("./directives/commentDirective"),u=e("./directives/savePresetDirective"),l=e("./directives/loadSamples");!function(){var e=angular.module("myApp",["ngRoute","ngFileSaver","ngSanitize","ui.select"]);e.config(["$routeProvider",a.initRoutes]),e.controller("drumMachineController",["$scope","$compile","$http","$interval","serverBaseURL","FileSaver","Blob","socketEvents",o.drumMachineController]),e.controller("testController",["$scope",i.testController]),e.directive("tickSlider",s.tickSliderDirective),e.directive("theTrack",["$http","$compile","supportedAudioFormats",r.trackDirective]),e.directive("comment",c.commentDirective),e.directive("savePreset",u.savePresetDirective),e.directive("loadSamples",["$http","supportedAudioFormats",l.loadSamples]);var t=new Set;t.add("wav"),t.add("audio/wav"),t.add("audio/x-wav"),t.add("mp3"),t.add("audio/mp3"),t.add("audio/x-mp3"),t.add("ogg"),t.add("audio/ogg"),t.add("audio/x-ogg");var n={newPreset:"NEW_PRESET",newComment:"NEW_COMMENT"};e.constant("serverBaseURL","https://groovyera.herokuapp.com"),e.constant("supportedAudioFormats",t),e.constant("socketEvents",n)}()},{"./components/drum-machine/drumMachineController":7,"./components/test/testController":8,"./directives/commentDirective":9,"./directives/loadSamples":10,"./directives/savePresetDirective":11,"./directives/tickSliderDirective":12,"./directives/trackDirective":13,"./routes":14}],2:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.DrumMachine=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=(e("./audio-loader"),e("../utils/utils")),s=e("./Track");n.DrumMachine=function(){function e(){a(this,e),this.tag="[DrumMachine.js]",this.numberOfBeats=16;var t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,this.pannerNodeSupported=!1,this.bpm=120,this.bpmMin=30,this.bpmMax=240,this.timeSignature={num:4,den:4},this.tickTime=60/this.bpm/4,this.isPlaying=!1,this.isStopped=!0,this.buffers={},this.tracks={},this._tracksInSolo=new Set,this._tracksInMute=new Set,this.currentTickIndex=0,this.callBacksInLoop=[],this.soundURLs={kick:"app/assets/audio/kick.wav",snare:"app/assets/audio/snare.wav",hat:"app/assets/audio/hat.wav",ride:"app/assets/audio/ride.wav"},(0,r.checkIfiOSdevice)()?this._enableAudioContextForiOS():this.audioContextEnabled=!0,"function"==typeof this.audioContext.createStereoPanner?(this.pannerNodeSupported=!0,console.log("Stereo panner supported")):console.log("Stereo panner not supported")}return i(e,[{key:"_enableAudioContextForiOS",value:function(){var e=this;$(document).ready(function(){var t=$("<button/>",{visibility:"hidden"});t.on("touchstart",function(){var t=e.audioContext.createBuffer(1,1,22050),n=e.audioContext.createBufferSource();n.buffer=t,n.start(),e.audioContextEnabled=!0,console.log("AudioContext enabled for iOS")}),t.trigger("touchstart")})}},{key:"_onBpmChanged",value:function(){this.tickTime=60/this.bpm/4}},{key:"_start",value:function(){function e(){if(t.isStopped)return clearTimeout(r),void(t.isPlaying=!1);if(o<=n.currentTime+t.tickTime){t.isPlaying=!0,t.isStopped=!1,$.each(t.tracks,function(e,t){if(!t.mute&&t.sampleData.decodedAudioBuffer){var a=t.ticks[i];if(a.active){var r=n.createBufferSource();r.buffer=t.sampleData.decodedAudioBuffer;var s=n.createGain();r.connect(s),s.gain.value=a.volume,s.connect(t.gainNode),r.start(o)}}}),t.currentTickIndex=i;var a=0===i?t.numberOfBeats-1:i-1,c=0===a?t.numberOfBeats-1:a-1;s&&t.callBacksInLoop.forEach(function(e){e(c,a)}),o+=t.tickTime,i=++i===t.numberOfBeats?0:i}s=!0,r=window.setTimeout(e,0)}if(!this.audioContextEnabled)return void console.log("Cannot play: AudioContext is not enabled.");if(this.isPlaying)return void console.log("Cannot play: it is already playing.");this.isStopped=!1;var t=this,n=this.audioContext,a=n.currentTime,o=a+t.tickTime,i=0,r=void 0,s=!1;e()}},{key:"_stop",value:function(){this.isStopped=!0}},{key:"_playSound",value:function(e,t){var n=this.audioContext,a=n.createBufferSource();a.buffer=this.buffers[e],a.connect(n.destination),a.start(t)}},{key:"playSoundFromBuffer",value:function(e,t){if(e){var n=this.audioContext,a=n.createBufferSource();a.buffer=e,a.connect(n.destination),t?a.start(t):a.start()}}},{key:"removeTrack",value:function(e){var t=this.tracks[e];this._tracksInSolo.delete(t),this._tracksInMute.delete(t),delete this.tracks[e]}},{key:"soloTrack",value:function(e){if(this.tracks.hasOwnProperty(e)){var t=this.tracks[e],n=this._tracksInSolo,a=this._tracksInMute;n.has(t)||a.has(t)?n.has(t)?(n.delete(t),t.solo=!1,n.size>0?(a.add(t),t.mute=!0):(a.clear(),n.clear(),$.each(this.tracks,function(e,t){t.mute=!1,t.solo=!1}))):(n.add(t),t.solo=!0,t.mute=!1,1===n.size&&$.each(this.tracks,function(t,n){t!==e&&(a.add(n),n.mute=!0)})):(n.add(t),t.solo=!0,t.mute=!1,$.each(this.tracks,function(t,o){t!==e&&(n.has(o)||(a.add(o),o.mute=!0,o.solo=!1))}))}}},{key:"muteTrack",value:function(e){if(this.tracks.hasOwnProperty(e)){var t=this.tracks[e],n=this._tracksInSolo,a=this._tracksInMute;n.has(t)||a.has(t)?n.has(t)?(n.delete(t),a.add(t),t.solo=!1,t.mute=!0,0===n.size&&$.each(this.tracks,function(t,n){t!==e&&(a.delete(n),n.mute=!1)})):a.has(t)&&(n.size>0?(a.delete(t),n.add(t),t.mute=!1,t.solo=!0):(a.delete(t),t.mute=!1)):(a.add(t),t.mute=!0,t.solo=!1)}}},{key:"addCallBackInLoop",value:function(e){"function"!==!(void 0===e?"undefined":o(e))&&this.callBacksInLoop.push(e)}},{key:"isInRangeBPM",value:function(e){return e>=this.bpmMin&&e<=this.bpmMax}},{key:"_createEmptyTicksArray",value:function(){for(var e=[],t=0;t<this.numberOfBeats;t++)e.push({index:t,volume:0,active:!1});return e}},{key:"_clearTracks",value:function(){this._tracksInSolo.clear(),this._tracksInMute.clear();for(var e in this.tracks)this.tracks.hasOwnProperty(e)&&delete this.tracks[e]}},{key:"addEmptyTrack",value:function(){var e="track_"+(Object.keys(this.tracks).length+1),t=new s.Track(this,e);t.setTicksFromArray(this._createEmptyTicksArray()),this.tracks[t.id]=t}},{key:"createTrack",value:function(e,t,n,a,o){var i=this;return new Promise(function(r,c){var u=new s.Track(i,e,t);o?u.setTicksFromArray(o):u.setTicksFromArray(i._createEmptyTicksArray()),n&&(u.gainNode.gain.value=n),a&&u.pannerNode&&(u.pannerNode.pan.value=a),r(u)})}},{key:"loadPreset",value:function(e){var t=this;try{this.bpm=e.bpm,this._clearTracks();var n=[];return e.tracks.forEach(function(e){n.push(t.createTrack(e.name,e.soundPath,e.volume,e.pan,e.ticks))}),Promise.all(n)}catch(e){return new Promise(function(t,n){n(e)})}}},{key:"buildJsonPreset",value:function(e,t){var n=this,a={name:e,category:t,bpm:this.bpm,timeSignature:this.timeSignature},o=[];for(var i in this.tracks)this.tracks.hasOwnProperty(i)&&function(){var e=n.tracks[i],a={name:e.name,soundPath:t+"/"+e.sampleData.fileName,volume:e.gainNode.gain.value,pan:n.pannerNodeSupported?e.pannerNode.pan.value:0},r=[];e.ticks.forEach(function(e){r.push({active:e.active,index:e.index,volume:e.volume})}),a.ticks=r,o.push(a)}();return a.tracks=o,JSON.stringify(a)}},{key:"bpm",get:function(){return this._bpm},set:function(e){e!==this._bpm&&(this._bpm=e,this._onBpmChanged())}}]),e}()},{"../utils/utils":15,"./Track":4,"./audio-loader":5}],3:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});n.Tick=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;a(this,e),this.index=t,this.active=n,this.volume=o}},{}],4:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Track=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=e("./Tick"),s=e("../utils/utils");n.Track=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"track_default",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=this,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];a(this,e),this.id=(0,s.guid)(),this.drumMachine=t,this.audioContext=t.audioContext,this.name=n,this.sampleData={fileName:"",extension:"",originalBuffer:void 0,decodedAudioBuffer:void 0},this.solo=!1,this.mute=u,this.ticks=[],this.pannerNodeSupported=!1,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=i,t.pannerNodeSupported?(this.pannerNode=this.audioContext.createStereoPanner(),this.pannerNode.pan.value=c,this.gainNode.connect(this.pannerNode),this.pannerNode.connect(this.audioContext.destination),this.pannerNodeSupported=!0):this.gainNode.connect(this.audioContext.destination),o&&(0,s.getArrayAudioBufferFromUrl)(this.audioContext,o).then(function(e){var t=(0,s.getFileNameFromPath)(o);r.setSampleData(t,e)}),this._initTicks()}return i(e,[{key:"_initTicks",value:function(){this.ticks=[];for(var e=0;e<this.drumMachine.numberOfBeats;++e)this.ticks.push(new r.Tick(e))}},{key:"setTick",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e<0||e>this.drumMachine.numberOfBeats-1||(this.ticks[e].volume=n,this.ticks[e].active=t)}},{key:"setTicksFromArray",value:function(e){var t=this;e.forEach(function(e){if("object"===(void 0===e?"undefined":o(e))){if("undefined"===e.index||e.index<0||e.index>t.drumMachine.numberOfBeats-1)return;t.ticks[e.index].volume="undefined"!==e.volume?e.volume:0,t.ticks[e.index].active="undefined"!==e.active&&e.active}else t.ticks[e].active=!0})}},{key:"setBuffer",value:function(e,t){var n=this;this.originalBuffer=e,this.drumMachine.audioContext.decodeAudioData(e,function(e){n.buffer=e,console.log("Track "+n.name+": audio buffer changed ( "+t+" )")})}},{key:"playLoadedSample",value:function(){if(this.audioContext&&this.sampleData.decodedAudioBuffer){var e=this.audioContext.createBufferSource();e.buffer=this.sampleData.decodedAudioBuffer,e.connect(this.audioContext.destination),e.start()}}},{key:"setSampleData",value:function(e,t){var n=this;if(!e||!t)return void console.log("Missing fileName and/or arrayAudioBuffer parameters");this.drumMachine.audioContext.decodeAudioData(t,function(a){n.sampleData.fileName=e,n.sampleData.extension=(0,s.getExtensionFromFileName)(e),n.sampleData.originalBuffer=t,n.sampleData.decodedAudioBuffer=a})}}]),e}()},{"../utils/utils":15,"./Tick":3}],5:[function(e,t,n){"use strict";function a(e,t){return new Promise(function(n,a){if(!e)return void a("Missing audio context parameter.");if(!t)return void a("Missing url parameter");var o=new XMLHttpRequest;o.open("GET",t),o.responseType="arraybuffer",o.onload=function(){try{e.decodeAudioData(o.response,function(e){n(e)})}catch(e){a(e)}},o.send()})}function o(e,t){return new Promise(function(n,a){if(!e)return void a("Missing audio context parameter.");if(!t)return void a("Missing url parameter");var o=new XMLHttpRequest;o.open("GET",t),o.responseType="arraybuffer",o.onload=function(){n(o.response)},o.send()})}Object.defineProperty(n,"__esModule",{value:!0}),n.audioLoader=a,n.getArrayBuffer=o},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.groovyRockPreset={name:"Groovy rock",bpm:120,category:"rock",timeSignature:{num:4,den:4},tracks:[{name:"kick",soundPath:"app/assets/samples/rock/rock-kick.wav",volume:1,pan:0,ticks:[{active:!0,index:0,volume:1},{active:!0,index:4,volume:1},{active:!0,index:8,volume:1},{active:!0,index:10,volume:1},{active:!0,index:12,volume:1}]},{name:"snare",soundPath:"app/assets/samples/rock/rock-snare.wav",volume:1,pan:0,ticks:[{active:!0,index:4,volume:1},{active:!0,index:12,volume:1}]},{name:"ghost-snare",soundPath:"app/assets/samples/rock/rock-snare-ghost.wav",volume:1,pan:0,ticks:[{active:!0,index:15,volume:1}]},{name:"hh open",soundPath:"app/assets/samples/rock/rock-hh-open.wav",volume:.4,pan:.5,ticks:[{active:!0,index:4,volume:.8},{active:!0,index:8,volume:.8},{active:!0,index:12,volume:.8}]},{name:"crash",soundPath:"app/assets/samples/rock/rock-crash.wav",volume:.5,pan:-.5,ticks:[{active:!0,index:0,volume:.8}]}]},n.psyTrancePreset={name:"psy-trance",category:"trance",bpm:145,timeSignature:{num:4,den:4},tracks:[{name:"kick",soundPath:"app/assets/samples/trance/trance-kick.wav",volume:1,pan:0,ticks:[{active:!0,index:0,volume:1},{active:!0,index:4,volume:1},{active:!0,index:8,volume:1},{active:!0,index:12,volume:1}]},{name:"clap",soundPath:"app/assets/samples/trance/trance-clap.wav",volume:1,pan:0,ticks:[{active:!0,index:4,volume:1},{active:!0,index:12,volume:1}]},{name:"hh open",soundPath:"app/assets/samples/trance/trance-hh-open.wav",volume:.8,pan:.2,ticks:[{active:!0,index:2,volume:.8},{active:!0,index:6,volume:.8},{active:!0,index:10,volume:.8},{active:!0,index:14,volume:.8}]},{name:"bass",soundPath:"app/assets/samples/trance/trance-bass-A1.wav",volume:.8,pan:0,ticks:[{active:!0,index:1,volume:.8},{active:!0,index:2,volume:.8},{active:!0,index:3,volume:.8},{active:!0,index:5,volume:.8},{active:!0,index:6,volume:.8},{active:!0,index:7,volume:.8},{active:!0,index:9,volume:.8},{active:!0,index:10,volume:.8},{active:!0,index:11,volume:.8},{active:!0,index:13,volume:.8},{active:!0,index:14,volume:.8},{active:!0,index:15,volume:.8}]}]}},{}],7:[function(e,t,n){"use strict";function a(e,t,n,a,s,c,u,l){function d(e){P.removeTrack(e.id)}function p(t){t&&(t.preventDefault(),t.stopPropagation()),_.removeClass("sequencer-stop-active"),A.removeClass("sequencer-play-inactive"),_.addClass("sequencer-stop-inactive"),A.addClass("sequencer-play-active"),A.css({backgroundColor:"transparent"}),_.css({backgroundColor:"transparent"}),e.startSequencer()}function m(t){t&&(t.preventDefault(),t.stopPropagation()),A.removeClass("sequencer-play-active"),_.removeClass("sequencer-stop-inactive"),A.addClass("sequencer-play-inactive"),_.addClass("sequencer-stop-active"),A.css({backgroundColor:"transparent"}),_.css({backgroundColor:"transparent"}),e.stopSequencer()}function f(t){window.scrollTo(0,0),y(),P.loadPreset(t).then(function(n){n.forEach(function(e){P.tracks[e.id]=e}),e.bpm=P.bpm,D.slider("value",e.bpm),e.preset.name=t.name,$("#presetTitle").text(e.preset.name),e.safeApply(),b()},function(e){console.log(e)})}function v(){var t=$("nav#menu").data("mmenu"),n=$('<li><a href="#exportMidi" >Export midi</a></li>');n.click(e.exportMidi),$("#menu-list").find(".mm-listview").append(n),t.initPanels($("#menu-list"))}function h(e){$('li[id="presetsMenu"]').remove(),n({url:s+"/api/presets",method:"GET",headers:{Accept:"application/json"}}).then(function(t){var n=t.data;if(0!==n.length){var a=$('<li id="presetsMenu"><a href="#">Presets</a></li>'),o=$("<ul></ul>");a.append(o),e.forEach(function(e){var t=n.find(function(t){return t._id===e.name});if(t){var a=t.presets,i=$('<li><a href="#">'+e.name+"</a></li>"),r=$("<ul></ul>");a.forEach(function(e){var t=$('<li><a href="#">'+e.name+"</a></li>");t.click(function(){f(e)}),r.append(t)}),i.append(r),o.append(i)}});var i=$("nav#menu").data("mmenu");$("#menu-list").find(".mm-listview li:first").after(a),i.initPanels($("#menu-list"))}},function(e){console.log(e),v()})}function k(){var n=$('<li><a href="#">Save preset</a></li>');n.click(function(){var n=angular.element(document.createElement("save-preset")),a=t(n)(e);angular.element(document.body).append(a)});var a=$("nav#menu").data("mmenu");$("#menu-list").find(".mm-listview").append(n),a.initPanels($("#menu-list"))}function g(){x(),n({url:s+"/api/comments",method:"GET",headers:{Accept:"application/json"}}).then(function(t){console.log(t),e.comments=t.data,e.safeApply(),S()},function(e){console.log(e)})}function y(){setTimeout(function(){window.scrollTo(0,0),T.addClass("loading-active")},0)}function b(){setTimeout(function(){window.scrollTo(0,0),T.removeClass("loading-active")},1500)}function x(){setTimeout(function(){M.addClass("loading-active"),B.addClass("loading-active")},0)}function S(){setTimeout(function(){M.removeClass("loading-active"),B.removeClass("loading-active")},100)}function w(e){$.toast({text:e,showHideTransition:"slide",bgColor:"#ff4a40",textColor:"#fff",allowToastClose:!1,hideAfter:3e3,stack:5,textAlign:"left",position:"top-right"})}function C(e){$.toast({text:e,showHideTransition:"slide",bgColor:"#05a2fc",textColor:"#fff",allowToastClose:!1,hideAfter:3e3,stack:5,textAlign:"left",position:"top-right"})}var P=new o.DrumMachine,T=$("#loadingContainer"),M=$("#commentsLoadingOverlay"),B=$("#commentsLoadingSpinner"),A=$("#sequencerPlayButton"),_=$("#sequencerStopButton"),D=$("#sequencerBPMslider");e.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},e.title="Main Controller",e.tracks=[],e.ticksElements=[],e.audioContext=P.audioContext,e.bpm=P.bpm,e.isPlaying=P.isPlaying,e.isStopped=P.isStopped,e.removeTrack=d,e.integerval=/^\d*$/,e.beats=new Array(P.numberOfBeats).fill(!1),e.samplesData={},e.samplesBuffers={},e.username="",e.commentToPost="",e.comments=[],e.invalidUsernameMessage="Give ya a name! (3-32 characters)",e.invalidCommentMessage="Write something cool! (3-1000 characters)",e.preset={name:"",categorySelected:void 0,categories:[]},e.tracks=P.tracks,e.safeApply(),$("#accordion").accordion({animate:200,collapsible:!0,active:!1,heightStyle:"content",beforeActivate:function(){0===e.comments.length&&g()}}),$("#postCommentBtn").button({icon:"ui-icon-pencil"}),$(window).ready(function(){function e(e,t){$(n[e]).removeClass("beat-indicator-active"),$(n[t]).addClass("beat-indicator-active")}var t=document.getElementById("beatIndicators"),n=t.getElementsByClassName("beat-indicator");P.addCallBackInLoop(e)}),window.addEventListener("keyup",function(t){switch(t.keyCode){case 32:$('textarea#commentArea, input#usernameInput, input[name="trackName"], input[name="presetName"]').is(":focus")?t.stopPropagation():e.isStopped?p(t):m(t)}}),window.addEventListener("keydown",function(e){switch(e.keyCode){case 32:$('textarea#commentArea, input#usernameInput, input[name="trackName"], input[name="presetName"]').is(":focus")?e.stopPropagation():(e.preventDefault(),e.stopPropagation())}}),window.addEventListener("keydown",function(e){32===e.keyCode&&e.target===document.body&&e.preventDefault()}),e.enableLoadingSpinner=y,e.disableLoadingSpinner=b,e.audioLoader=i.audioLoader,e.playSoundFromBuffer=P.playSoundFromBuffer,e.startSequencer=function(){P._start(),e.isPlaying=!0,e.isStopped=!1},e.stopSequencer=function(){P._stop(),e.isPlaying=!1,e.isStopped=!0;var t=document.getElementById("beatIndicators").getElementsByClassName("beat-indicator");$(t).removeClass("beat-indicator-active")},e.addTrack=function(){P.addEmptyTrack()},e.exportMidi=function(){var e=[];for(var t in P.tracks)P.tracks.hasOwnProperty(t)&&function(){var n=P.tracks[t],a={name:n.name,notes:[]},o=0;n.ticks.forEach(function(e){if(e.active){var t={pitch:["C4"],velocity:e.volume,duration:"16"};if(o>0){var n="T"+32*o;t.wait=n}a.notes.push(t),o=0}else o+=1}),e.push(a)}();var a={bpm:P.bpm,timeSignature:{num:4,den:4},tracks:e};n({url:s+"/api/midi",method:"POST",responseType:"arraybuffer",headers:{"Content-Type":"application/json"},data:JSON.stringify(a)}).then(function(e){console.log(e);var t=new u([e.data],{type:"audio/midi"});c.saveAs(t,"loop.mid")},function(e){console.log(e)})},e.populateCategories=function(){return new Promise(function(t,a){n({url:s+"/api/categories",method:"GET",headers:{Accept:"application/json"}}).then(function(n){var a=n.data;e.preset.categories=a,t(a)},function(e){console.log(e),a(e)})})},e.savePreset=function(){var t=new FormData,n=P.buildJsonPreset(e.preset.name,e.preset.categorySelected.name);for(var a in P.tracks)if(P.tracks.hasOwnProperty(a)){var o=P.tracks[a],i=new u([o.sampleData.originalBuffer],{type:"octet-stream"});t.append("sample",i,o.sampleData.fileName)}t.append("preset",n);var r=new XMLHttpRequest;r.open("POST",s+"/api/presets",!0),r.setRequestHeader("Accept","application/json"),r.onload=function(){201===r.status?(C("Preset saved! ;-)"),e.onPresetCancel()):409===r.status?(console.log(r.response),w("Preset name "+e.preset.name+" already taken for category "+e.preset.categorySelected.name)):(w("Ops! Something went wrong :-("),e.onPresetCancel())},r.send(t)},e.uploadFiles=function(){function e(e){console.log(e)}var t=new FormData;for(var n in P.tracks)if(P.tracks.hasOwnProperty(n)){var a=P.tracks[n],o=new u([a.sampleData.originalBuffer],{type:"octet-stream"});t.append("sample",o,a.sampleData.fileName)}var i={name:"track",bpm:120,tracks:[{name:"kick"},{name:"snare"}]};t.append("preset",JSON.stringify(i));var r=new XMLHttpRequest;r.open("POST",s+"/api/upload",!0),r.setRequestHeader("Accept","application/json"),r.onload=e,r.send(t)},e.postComment=function(){var t={username:e.username,message:e.commentToPost};n({url:s+"/api/comments",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:JSON.stringify(t)}).then(function(e){console.log(e)},function(e){console.log(e)})},e.onPresetCancel=function(){$(".save-preset-container").remove()},e.onPresetSave=function(){e.savePreset()};var E=io.connect(s);!function(e,t){A.on("mousedown touchstart",function(e){e.preventDefault(),e.stopPropagation(),A.css({backgroundColor:"#444"})}),A.on("mouseup touchend",function(e){p(e)}),_.on("mousedown touchstart",function(e){e.preventDefault(),e.stopPropagation(),_.css({backgroundColor:"#444"})}),_.on("mouseup touchend",function(e){m(e)}),D.slider({min:t.bpmMin,max:t.bpmMax,orientation:"horizontal",value:e.bpm,slide:function(n,a){t.bpm=a.value,e.bpm=a.value,e.$apply()}}).draggable(),e.updateSlider=function(){t.isInRangeBPM(e.bpm)&&(D.slider("value",e.bpm),t.bpm=e.bpm)}}(e,P),f(r.groovyRockPreset),window.scrollTo(0,0),$(window).ready(function(){window.scrollTo(0,0),k(),v(),e.populateCategories().then(function(e){h(e)}),a(function(){e.populateCategories().then(function(e){console.log("$interval: populateCategories")})},2e4),E.on(l.newPreset,function(t){console.log(l.newPreset,t),h(e.preset.categories)}),E.on(l.newComment,function(t){e.comments.splice(0,0,t),e.commentToPost="",e.commentForm.$setPristine(),e.safeApply()})})}Object.defineProperty(n,"__esModule",{value:!0}),n.drumMachineController=a;var o=e("../../audio/DrumMachine"),i=e("../../audio/audio-loader"),r=e("../../audio/presets")},{"../../audio/DrumMachine":2,"../../audio/audio-loader":5,"../../audio/presets":6}],8:[function(e,t,n){"use strict";function a(e){e.title="Test Controller",console.log("Test Controller")}Object.defineProperty(n,"__esModule",{value:!0}),n.testController=a},{}],9:[function(e,t,n){"use strict";function a(){return{restrict:"AE",replace:"false",templateUrl:"app/directives/templates/commentDirective.html",link:function(e,t,n){}}}Object.defineProperty(n,"__esModule",{value:!0}),n.commentDirective=a},{}],10:[function(e,t,n){"use strict";function a(e,t){return{restrict:"AE",replace:"false",templateUrl:"app/directives/templates/loadSamples.html",link:function(e,t,n){function a(){$(".samples-accordion").accordion({animate:200,collapsible:!0,active:!1,heightStyle:"content"}),t.find('button[name="playSampleButton"]').button({icon:"ui-icon-circle-triangle-e",showLabel:!1}),t.find('button[name="loadSampleButton"]').button({icon:"ui-icon-check",showLabel:!1}),t.find('button[id="samplesCancelBtn"]').button(),t.css("display","block"),e.disableLoadingSpinner()}function i(){}e.close=function(){$("#angularView").css("display","block"),t.remove()},e.playSampleFromServer=function(t){if(t)if(e.samplesBuffers.hasOwnProperty(t.path)){var n=e.samplesBuffers[t.path];e.playSoundFromBuffer(n)}else e.audioLoader(e.audioContext,t.path).then(function(n){e.samplesBuffers[t.path]=n,e.playSoundFromBuffer(n)})},e.loadSampleOnTrack=function(t){t&&(0,o.getArrayBuffer)(e.audioContext,t.path).then(function(n){e.track.setSampleData(t.name,n),e.close()})},function(){$("#angularView").css("display","none");var e=setInterval(function(){$(".samples-accordion").length>0&&(clearInterval(e),a(),i())},200)}()}}}Object.defineProperty(n,"__esModule",{value:!0}),n.loadSamples=a;var o=e("../audio/audio-loader")},{"../audio/audio-loader":5}],11:[function(e,t,n){"use strict";function a(){return{restrict:"AE",replace:"false",templateUrl:"app/directives/templates/savePreset.html",link:function(e,t,n){e.tagHandler=function(e){return null},e.invalidPresetNameMessage="Choose a preset name (4-24 characters)",e.invalidCategoryMessage="Choose a category",function(){$("#presetCancelBtn").button(),$("#presetSaveBtn").button()}()}}}Object.defineProperty(n,"__esModule",{value:!0}),n.savePresetDirective=a},{}],12:[function(e,t,n){"use strict";function a(){return{restrict:"AE",replace:"false",scope:{tick:"=",ticksElements:"=",resizeTick:"="},link:function(e,t,n){e.ticksElements.push(t),t.slider({min:0,max:100,orientation:"vertical",value:e.tick.active?100*e.tick.volume:0,slide:function(t,n){0===n.value?e.tick.active=!1:e.tick.active=!0,e.tick.volume=.01*n.value}}).draggable()}}}Object.defineProperty(n,"__esModule",{value:!0}),n.tickSliderDirective=a},{}],13:[function(e,t,n){"use strict";function a(e,t,n){return{restrict:"AE",replace:"false",scope:{track:"=",ticksElements:"=",samplesData:"=",samplesBuffers:"=",removeTrack:"=",audioContext:"=",audioLoader:"=",playSoundFromBuffer:"=",enableLoadingSpinner:"=",disableLoadingSpinner:"="},templateUrl:"app/directives/templates/trackDirective.html",link:function(a,i,r){function s(e){var t=i.find(".ticks-container").width();console.log(t);Math.floor((t-120)/16)}function c(e){if(e&&!(e.length<1)){var t=e[0],i=(0,o.getFileExtension)(t.name);if(!n.has(i))return void console.log("File format not supported by Web Audio API: ",i);var r=new FileReader;r.onload=function(e){var n=e.target.result;a.track.setSampleData(t.name,n)},r.readAsArrayBuffer(t)}}function u(e){i.hasClass("track-dragfile")||i.addClass("track-dragfile"),e.stopPropagation(),e.preventDefault()}function l(e){e.stopPropagation(),e.preventDefault(),c(e.originalEvent.dataTransfer.files),d()}function d(e){i.hasClass("track-dragfile")&&i.removeClass("track-dragfile"),e&&(e.stopPropagation(),e.preventDefault())}function p(){a.track.playLoadedSample()}function m(){a.track.drumMachine.soloTrack(a.track.id)}function f(){a.track.drumMachine.muteTrack(a.track.id)}function v(){a.enableLoadingSpinner(),e({url:h+"/api/samples",method:"GET",headers:{Accept:"application/json"}}).then(function(e){a.samplesData=e.data;var n=$("<load-samples></load-samples>"),o=t(n)(a);$("body").append(o)})}var h="https://groovyera.herokuapp.com";a.resizeTick=s,a.handleFiles=c,a.playSound=p,a.onSoloTrack=m,a.onMuteTrack=f,a.loadSamplesFromServer=v,i.find('button[name="removeTrackButton"]').button({icon:"ui-icon-close",showLabel:!1}),i.find('button[name="playSoundButton"]').button({icon:"ui-icon-circle-triangle-e",showLabel:!1}),i.find('button[name="loadSoundFromServerBtn"]').button(),i.find('div[id="trackVolumeSlider"]').slider({min:0,max:100,orientation:"horizontal",value:100*a.track.gainNode.gain.value,slide:function(e,t){a.track.gainNode.gain.value=.01*t.value}}).draggable(),a.track.pannerNodeSupported?i.find('div[id="trackPanSlider"]').slider({min:-100,max:100,orientation:"horizontal",value:100*a.track.pannerNode.pan.value,slide:function(e,t){a.track.pannerNode.pan.value=.01*t.value}}).draggable():(i.find('div[id="trackPanSlider"]').remove(),i.find(".pan-label").remove(),i.find('div[id="trackVolumeSlider"]').css({})),i.find('button[name="soloTrackButton"]').button(),i.find('button[name="muteTrackButton"]').button(),i.find('button[name="loadSoundFromServerBtn"]').button({showLabel:!1,icon:"ui-icon-volume-on"}),a.$on("$destroy",function(){i.unbind("dragover",u),i.unbind("drop",l),i.unbind("dragleave",d)}),i.on("dragover",u),i.on("drop",l),i.on("dragleave",d)}}}Object.defineProperty(n,"__esModule",{value:!0}),n.trackDirective=a;var o=e("../utils/utils")},{"../utils/utils":15}],14:[function(e,t,n){"use strict";function a(e){e.when("/",{controller:"drumMachineController",templateUrl:"app/components/drum-machine/drumMachineView.html"}),e.when("/test",{controller:"testController",templateUrl:"app/components/test/testView.html"}),e.otherwise({redirectTo:"/"})}Object.defineProperty(n,"__esModule",{value:!0}),n.initRoutes=a},{}],15:[function(e,t,n){"use strict";function a(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function i(e){return/(?:\.([^.]+))?$/.exec(e)[1]}function r(e){return e.replace(/^.*[\\\/]/,"")}function s(e,t){return new Promise(function(n,a){if(!e)return void a("Missing audio context parameter.");if(!t)return void a("Missing url parameter");var o=new XMLHttpRequest;o.open("GET",t),o.responseType="arraybuffer",o.onload=function(){n(o.response)},o.send()})}function c(e){return e.substr(e.lastIndexOf(".")+1)}Object.defineProperty(n,"__esModule",{value:!0}),n.checkIfiOSdevice=a,n.guid=o,n.getExtensionFromFileName=i,n.getFileNameFromPath=r,n.getArrayAudioBufferFromUrl=s,n.getFileExtension=c},{}]},{},[1]);
//# sourceMappingURL=app.bundle.min.js.map
